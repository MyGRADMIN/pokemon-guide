<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokémon Beginner's Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            background-image: url('https://placehold.co/1920x1080/E0E7FF/555?text=Poke+Background');
            background-size: cover;
            background-attachment: fixed;
        }
        .card-container {
            background-color: #fff;
            border-radius: 1.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        .rarity-symbol {
            font-size: 1.5rem;
            line-height: 1;
            margin-right: 0.5rem;
            display: inline-block;
            width: 1.5rem;
            text-align: center;
        }
        .tts-button {
            transition: transform 0.1s ease, box-shadow 0.1s ease;
        }
        .tts-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .tts-button:active {
            transform: translateY(1px);
            box-shadow: none;
        }
        .card-image {
            max-width: 100%;
            height: auto;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease;
        }
        .card-image:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="card-container max-w-4xl mx-auto p-6 md:p-10 my-8">
        <header class="text-center mb-10">
            <h1 class="text-5xl font-extrabold text-red-600 tracking-tight">
                Pokémon Beginner's Guide
            </h1>
            <p class="mt-2 text-xl text-gray-600">
                Identification, Rarity, and How to Play
            </p>
            <button id="tts-header-button" class="tts-button mt-4 px-6 py-2 bg-yellow-400 text-gray-900 font-bold rounded-full shadow-md hover:bg-yellow-500 flex items-center mx-auto" onclick="speakText('Pokémon Beginners Guide. Identification, Rarity, and How to Play.')">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 mr-2">
                    <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0 1 10 3v14a1 1 0 0 1-.82-.494l-3-7A1 1 0 0 0 6 9H3a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h3c.125 0 .245.02.357.068l3 3.5a1 1 0 0 0 1.62-.777V6.5a1 1 0 0 1 1-1 7.002 7.002 0 0 0 0 10 1 1 0 0 1-1 1 8.002 8.002 0 0 1 0-12z" clip-rule="evenodd" />
                </svg>
                Listen to Title
            </button>
            <div id="loading-indicator" class="mt-2 text-sm text-indigo-600 hidden">Generating audio...</div>
            <audio id="audio-player" class="hidden" controls></audio>
        </header>

        <!-- Rarity Section -->
        <section class="mb-10">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-3xl font-bold text-indigo-700 border-b-2 pb-2">
                    Card Identification & Rarity Symbols
                </h2>
                <button class="tts-button px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-semibold" onclick="speakSection('rarity-section-content')">
                    Read Section
                </button>
            </div>
            <div id="rarity-section-content">
                <p class="text-gray-700 mb-6">
                    Every Pokémon card has a small symbol, usually at the bottom corner near the card number, that tells you its rarity.
                </p>

                <div class="space-y-3">
                    <div class="flex items-center p-3 bg-gray-50 rounded-lg shadow-sm">
                        <span class="rarity-symbol text-black font-bold">⚫</span>
                        <strong class="text-gray-800 w-24">Common:</strong>
                        <span class="text-gray-600">You’ll find lots of these cards.</span>
                    </div>
                    <div class="flex items-center p-3 bg-gray-50 rounded-lg shadow-sm">
                        <span class="rarity-symbol text-gray-600 font-bold">◆</span>
                        <strong class="text-gray-800 w-24">Uncommon:</strong>
                        <span class="text-gray-600">A little harder to find.</span>
                    </div>
                    <div class="flex items-center p-3 bg-gray-50 rounded-lg shadow-sm">
                        <span class="rarity-symbol text-yellow-500 font-bold">★</span>
                        <strong class="text-gray-800 w-24">Rare:</strong>
                        <span class="text-gray-600">Harder to find — usually shiny or strong!</span>
                    </div>
                    <div class="flex items-center p-3 bg-yellow-50 rounded-lg shadow-sm">
                        <span class="rarity-symbol text-yellow-600 font-bold">✨</span>
                        <strong class="text-gray-800 w-24">Holo:</strong>
                        <span class="text-gray-600">The Pokémon picture is shiny.</span>
                    </div>
                    <div class="flex items-center p-3 bg-yellow-50 rounded-lg shadow-sm">
                        <span class="rarity-symbol text-blue-500 font-bold">✨⬜</span>
                        <strong class="text-gray-800 w-24">Reverse Holo:</strong>
                        <span class="text-gray-600">The card background is shiny instead of the Pokémon.</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Special Cards Section -->
        <section class="mb-10">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-3xl font-bold text-indigo-700 border-b-2 pb-2">
                    Special Cards (EX, GX, V, VMAX, MEGA)
                </h2>
                <button class="tts-button px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-semibold" onclick="speakSection('special-section-content')">
                    Read Section
                </button>
            </div>
            <div id="special-section-content">
                <p class="text-gray-700 mb-6">
                    These cards are extra powerful and have unique rules or abilities.
                </p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="p-4 border border-indigo-200 rounded-lg bg-indigo-50">
                        <strong class="text-lg text-indigo-800">EX:</strong> 
                        <span class="text-gray-700">Extra powerful Pokémon with big attacks.</span>
                    </div>
                    <div class="p-4 border border-indigo-200 rounded-lg bg-indigo-50">
                        <strong class="text-lg text-indigo-800">GX:</strong> 
                        <span class="text-gray-700">Special once-per-game attack card.</span>
                    </div>
                    <div class="p-4 border border-indigo-200 rounded-lg bg-indigo-50">
                        <strong class="text-lg text-indigo-800">V:</strong> 
                        <span class="text-gray-700">Strong modern Pokémon with high HP.</span>
                    </div>
                    <div class="p-4 border border-indigo-200 rounded-lg bg-indigo-50">
                        <strong class="text-lg text-indigo-800">VMAX:</strong> 
                        <span class="text-gray-700">Gigantic evolved version of V cards.</span>
                    </div>
                    <div class="p-4 border border-indigo-200 rounded-lg bg-indigo-50">
                        <strong class="text-lg text-indigo-800">MEGA:</strong> 
                        <span class="text-gray-700">Mega-evolved Pokémon from older sets.</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Player's Cards Section -->
        <section class="mb-10">
            <h2 class="text-3xl font-bold text-indigo-700 border-b-2 pb-2 mb-4">
                Your Featured Pokémon Cards
            </h2>
            <p class="text-gray-700 mb-6">
                These are the two cards you uploaded to the guide!
            </p>
            
            <div class="grid grid-cols-2 gap-4">
                <div class="text-center">
                    <img src="IMG_4472.jpg" alt="Rockruff Card" class="card-image mx-auto" onerror="this.onerror=null; this.src='https://placehold.co/300x420/8B5CF6/ffffff?text=Rockruff+Card';">
                    <p class="mt-2 font-semibold text-gray-700">Rockruff (Basic Pokémon)</p>
                </div>
                <div class="text-center">
                    <img src="IMG_4473.jpg" alt="Regenerative Energy Card" class="card-image mx-auto" onerror="this.onerror=null; this.src='https://placehold.co/300x420/3B82F6/ffffff?text=Regenerative+Energy';">
                    <p class="mt-2 font-semibold text-gray-700">Regenerative Energy (Special Energy)</p>
                </div>
            </div>
        </section>


        <!-- How to Play Section -->
        <section>
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-3xl font-bold text-indigo-700 border-b-2 pb-2">
                    How to Play Pokémon – Beginner Rules
                </h2>
                <button class="tts-button px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-semibold" onclick="speakSection('rules-section-content')">
                    Read Rules
                </button>
            </div>
            <div id="rules-section-content">
                <div class="flex items-center mb-4 text-xl">
                    <span class="text-3xl mr-3">🎯</span>
                    <strong class="text-red-700">Goal:</strong> Knock out your opponent’s Pokémon and win 6 Prize Cards!
                </div>
                
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 text-center text-gray-700 mb-6">
                    <div class="p-3 bg-green-100 rounded-lg"><span class="text-xl">👥</span> 2 Players</div>
                    <div class="p-3 bg-yellow-100 rounded-lg"><span class="text-xl">🎴</span> 60-Card Deck</div>
                    <div class="p-3 bg-blue-100 rounded-lg"><span class="text-xl">🧭</span> Setup & Bench</div>
                </div>

                <h3 class="text-2xl font-semibold text-indigo-600 mb-3">
                    ▶️ Turn Steps
                </h3>
                <ol class="list-decimal list-inside space-y-3 pl-4 text-gray-700">
                    <li class="p-2 border-l-4 border-indigo-400 pl-3 bg-gray-50 rounded-r-lg">
                        **Draw a card.**
                    </li>
                    <li class="p-2 border-l-4 border-indigo-400 pl-3 bg-gray-50 rounded-r-lg">
                        Place a Pokémon onto your **Bench** (up to 5 total).
                    </li>
                    <li class="p-2 border-l-4 border-indigo-400 pl-3 bg-gray-50 rounded-r-lg">
                        Attach **one Energy card** per turn to one of your Pokémon.
                    </li>
                    <li class="p-2 border-l-4 border-indigo-400 pl-3 bg-gray-50 rounded-r-lg">
                        Play **Trainer cards** to help your Pokémon (as many as you want).
                    </li>
                    <li class="p-2 border-l-4 border-indigo-400 pl-3 bg-gray-50 rounded-r-lg">
                        **Attack** if you have enough Energy.
                    </li>
                    <li class="p-2 border-l-4 border-indigo-400 pl-3 bg-gray-50 rounded-r-lg">
                        End your turn.
                    </li>
                </ol>
                
                <h3 class="text-2xl font-semibold text-indigo-600 mt-6 mb-3">
                    🏆 Winning the Game
                </h3>
                <ul class="list-disc list-inside space-y-2 pl-4 text-gray-700">
                    <li>Collect all **6 Prize Cards**.</li>
                    <li>If your opponent has no Pokémon left in play.</li>
                </ul>
            </div>
        </section>
        
        <footer class="mt-10 pt-6 border-t border-gray-200 text-center text-sm text-gray-500">
            Guide content based on Pokémon Beginners Guide and Labels document.
        </footer>
    </div>

<script>
    // --- TTS (Text-to-Speech) Implementation ---
    const AUDIO_MODEL = "gemini-2.5-flash-preview-tts";
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${AUDIO_MODEL}:generateContent?key=`;
    const VOICE = "Puck"; // Using a bright, upbeat voice

    const loadingIndicator = document.getElementById('loading-indicator');
    const audioPlayer = document.getElementById('audio-player');

    // Helper to convert base64 to ArrayBuffer
    function base64ToArrayBuffer(base64) {
        const binaryString = atob(base64);
        const len = binaryString.length;
        const bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binaryString.charCodeAt(i);
        }
        return bytes.buffer;
    }

    // Helper to convert PCM audio data into a WAV file blob
    function pcmToWav(pcm16, sampleRate) {
        const numChannels = 1;
        const bitsPerSample = 16;
        const byteRate = sampleRate * numChannels * (bitsPerSample / 8);
        const blockAlign = numChannels * (bitsPerSample / 8);
        const dataSize = pcm16.length * 2;
        
        const buffer = new ArrayBuffer(44 + dataSize);
        const view = new DataView(buffer);

        // RIFF chunk
        writeString(view, 0, 'RIFF');
        view.setUint32(4, 36 + dataSize, true); // Chunk size
        writeString(view, 8, 'WAVE');

        // FMT sub-chunk
        writeString(view, 12, 'fmt ');
        view.setUint32(16, 16, true); // Sub-chunk size
        view.setUint16(20, 1, true); // Audio format (1 = PCM)
        view.setUint16(22, numChannels, true); // Num channels
        view.setUint32(24, sampleRate, true); // Sample rate
        view.setUint32(28, byteRate, true); // Byte rate
        view.setUint16(32, blockAlign, true); // Block align
        view.setUint16(34, bitsPerSample, true); // Bits per sample

        // DATA sub-chunk
        writeString(view, 36, 'data');
        view.setUint32(40, dataSize, true); // Data size

        // Write PCM data
        let offset = 44;
        for (let i = 0; i < pcm16.length; i++, offset += 2) {
            view.setInt16(offset, pcm16[i], true);
        }

        return new Blob([buffer], { type: 'audio/wav' });
    }

    function writeString(view, offset, string) {
        for (let i = 0; i < string.length; i++) {
            view.setUint8(offset + i, string.charCodeAt(i));
        }
    }

    // Main function to speak text using the Gemini API
    async function fetchAudio(text) {
        const payload = {
            contents: [{
                parts: [{ text: text }]
            }],
            generationConfig: {
                responseModalities: ["AUDIO"],
                speechConfig: {
                    voiceConfig: {
                        prebuiltVoiceConfig: { voiceName: VOICE }
                    }
                }
            },
            model: AUDIO_MODEL
        };

        const apiKey = ""; // API key is provided by the canvas environment

        loadingIndicator.classList.remove('hidden');
        audioPlayer.classList.add('hidden');
        
        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                console.error('API call failed with status:', response.status);
                throw new Error('Failed to generate audio from API.');
            }

            const result = await response.json();
            const part = result?.candidates?.[0]?.content?.parts?.[0];
            const audioData = part?.inlineData?.data;
            const mimeType = part?.inlineData?.mimeType;

            if (audioData && mimeType && mimeType.startsWith("audio/L16")) {
                const sampleRateMatch = mimeType.match(/rate=(\d+)/);
                const sampleRate = sampleRateMatch ? parseInt(sampleRateMatch[1], 10) : 24000;
                
                const pcmData = base64ToArrayBuffer(audioData);
                const pcm16 = new Int16Array(pcmData);
                const wavBlob = pcmToWav(pcm16, sampleRate);
                
                const audioUrl = URL.createObjectURL(wavBlob);
                audioPlayer.src = audioUrl;
                audioPlayer.classList.remove('hidden');
                audioPlayer.play();
            } else {
                console.error("Audio data or mime type is missing/incorrect:", result);
            }
        } catch (error) {
            console.error("Error fetching or processing audio:", error);
        } finally {
            loadingIndicator.classList.add('hidden');
        }
    }

    function speakText(text) {
        fetchAudio(text);
    }

    function speakSection(elementId) {
        const element = document.getElementById(elementId);
        if (element) {
            // Remove text from buttons/emojis and consolidate text for better TTS quality
            const textContent = element.innerText.replace(/(\n\s*)+/g, '. ').replace(/[\u2700-\u27BF\uE000-\uF8FF\u2600-\u26FF]/g, '').trim();
            speakText(textContent);
        }
    }
</script>

</body>
</html>
